import{b as o,j as n}from"./react-DKHFF0Td.js";import{c as us}from"./react-dom-ok11LuJW.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const p of r.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&t(p)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();const W={1:["ğŸ€‡","ğŸ€ˆ","ğŸ€‰","ğŸ€Š","ğŸ€‹","ğŸ€Œ","ğŸ€","ğŸ€","ğŸ€"],2:["ğŸ€","ğŸ€‘","ğŸ€’","ğŸ€“","ğŸ€”","ğŸ€•","ğŸ€–","ğŸ€—","ğŸ€˜"],3:["ğŸ€™","ğŸ€š","ğŸ€›","ğŸ€œ","ğŸ€","ğŸ€","ğŸ€Ÿ","ğŸ€ ","ğŸ€¡"],4:["ğŸ€€","ğŸ€","ğŸ€‚","ğŸ€ƒ","ğŸ€„","ğŸ€…","ğŸ€†"]};function ls(c){return c.suit<=3?W[c.suit][c.num-1]:c.suit===4?W[4][c.num-1]:"ğŸ€„"}function ds(){const c=[];for(let e=1;e<=3;e++)for(let i=1;i<=9;i++)for(let t=0;t<4;t++)c.push({suit:e,num:i,id:`${e}-${i}-${t}`});for(let e=0;e<7;e++)for(let i=0;i<4;i++)c.push({suit:4,num:e+1,id:`4-${e+1}-${i}`});return c}function ms(c){const e=[...c];for(let i=e.length-1;i>0;i--){const t=Math.floor(Math.random()*(i+1));[e[i],e[t]]=[e[t],e[i]]}return e}function X(c){return[...c].sort((e,i)=>e.suit!==i.suit?e.suit-i.suit:e.num-i.num)}function Y(c,e){const i={};c.forEach(s=>{const r=`${s.suit}-${s.num}`;i[r]=(i[r]||0)+1});const t=`${e.suit}-${e.num}`;return(i[t]||0)>=2}function Z(c,e){const i={};c.forEach(s=>{const r=`${s.suit}-${s.num}`;i[r]=(i[r]||0)+1});const t=`${e.suit}-${e.num}`;return(i[t]||0)>=3}function ss(c,e){if(e.suit>3||e.suit===0)return!1;const i=[...c].sort((r,p)=>r.suit!==p.suit?r.suit-p.suit:r.num-p.num),t=e.num,s=e.suit;if(t>=2&&t<=8){const r=i.some(a=>a.suit===s&&a.num===t-1),p=i.some(a=>a.suit===s&&a.num===t+1);if(r&&p)return!0}if(t>=3&&t<=9){const r=i.some(a=>a.suit===s&&a.num===t-2),p=i.some(a=>a.suit===s&&a.num===t-1);if(r&&p)return!0}if(t>=1&&t<=7){const r=i.some(a=>a.suit===s&&a.num===t+1),p=i.some(a=>a.suit===s&&a.num===t+2);if(r&&p)return!0}return!1}function fs(c,e){if(e.suit>3)return[];const i=[],t=e.num,s=e.suit;if(t>=2&&t<=8){const r=c.some(a=>a.suit===s&&a.num===t-1),p=c.some(a=>a.suit===s&&a.num===t+1);if(r&&p){const a=c.filter(l=>l.suit===s&&l.num===t-1)[0],d=c.filter(l=>l.suit===s&&l.num===t+1)[0];i.push([a,d,e])}}if(t>=3){const r=c.some(a=>a.suit===s&&a.num===t-2),p=c.some(a=>a.suit===s&&a.num===t-1);if(r&&p){const a=c.filter(l=>l.suit===s&&l.num===t-2)[0],d=c.filter(l=>l.suit===s&&l.num===t-1)[0];i.push([a,d,e])}}if(t<=7){const r=c.some(a=>a.suit===s&&a.num===t+1),p=c.some(a=>a.suit===s&&a.num===t+2);if(r&&p){const a=c.filter(l=>l.suit===s&&l.num===t+1)[0],d=c.filter(l=>l.suit===s&&l.num===t+2)[0];i.push([a,d,e])}}return i}const K=new Map;function hs(c){return c.map(e=>`${e.suit}-${e.num}`).sort().join(",")}function _(c){if(c.length!==14)return!1;const e=hs(c);if(K.has(e))return K.get(e);const i=[...c].sort((d,l)=>d.suit!==l.suit?d.suit-l.suit:d.num-l.num),t={};i.forEach(d=>{const l=`${d.suit}-${d.num}`;t[l]=(t[l]||0)+1});const s=Object.keys(t),r=d=>{for(const l of s)if(d[l]>=2){const j={...d};if(j[l]-=2,p(j))return!0}return!1},p=d=>{const l=Object.entries(d).filter(([,f])=>f>0);if(l.length===0)return!0;const[j,k]=l[0],[u,m]=j.split("-").map(Number);if(u<=3){const f=`${u}-${m+1}`,v=`${u}-${m+2}`;if(d[f]&&d[v]&&d[f]>0&&d[v]>0){const x={...d};return x[j]-=1,x[f]-=1,x[v]-=1,p(x)}}if(k>=3){const f={...d};return f[j]-=3,p(f)}return!1},a=r(t);return K.set(e,a),a}const N=o.memo(function({tile:e,selected:i=!1,onClick:t,faceDown:s=!1,size:r="",className:p=""}){const a=o.useCallback(()=>{t&&!s&&e&&t(e)},[t,e,s]),d=`tile ${i?"selected":""} ${r||""} ${s?"face-down":""} ${p}`.trim();return n.jsx("div",{className:d,"data-suit":e?.suit,onClick:a,role:"button","aria-pressed":i,tabIndex:s?-1:0,children:s?"ğŸ€«":e?ls(e):""})}),ps=o.memo(function({hand:e,selectedTile:i,onTileClick:t,lastDrawn:s,pengs:r,gangs:p,chis:a}){const d=o.useMemo(()=>[...e].sort((u,m)=>u.suit!==m.suit?u.suit-m.suit:u.num-m.num),[e]),l=o.useCallback(u=>{t(u)},[t]),j=o.useMemo(()=>d.map(u=>n.jsx(N,{tile:u,selected:i?.id===u.id,onClick:l,size:s?.id===u.id?"large":""},u.id)),[d,i,l,s]),k=o.useMemo(()=>{const u=[];return r?.forEach((m,f)=>u.push({type:"peng",tiles:m,key:`peng-${f}`})),p?.forEach((m,f)=>u.push({type:"gang",tiles:m,key:`gang-${f}`})),a?.forEach((m,f)=>u.push({type:"chi",tiles:m,key:`chi-${f}`})),u.map(m=>m.type==="peng"?n.jsxs("div",{className:"meld peng",children:[n.jsx(N,{tile:m.tiles[0],size:"small"}),n.jsx(N,{tile:m.tiles[1],size:"small"}),n.jsx(N,{tile:m.tiles[2],size:"small"})]},m.key):m.type==="gang"?n.jsxs("div",{className:"meld gang",children:[n.jsx(N,{tile:m.tiles[0],size:"small"}),n.jsx(N,{tile:m.tiles[1],size:"small"}),n.jsx(N,{tile:m.tiles[2],size:"small"}),n.jsx(N,{tile:m.tiles[3],size:"small"})]},m.key):m.type==="chi"?n.jsxs("div",{className:"meld chi",children:[n.jsx(N,{tile:m.tiles[0],size:"small"}),n.jsx(N,{tile:m.tiles[1],size:"small"}),n.jsx(N,{tile:m.tiles[2],size:"small"})]},m.key):null)},[r,p,a]);return n.jsxs("div",{className:"player-hand",children:[n.jsx("div",{className:"melds",children:k}),n.jsx("div",{className:"hand-tiles",children:j})]})}),gs=o.memo(function({opponents:e}){return n.jsxs("div",{className:"opponents",children:[n.jsxs("div",{className:"opponent top",children:[n.jsx("span",{className:"opponent-name",children:e.top?.name}),n.jsx("div",{className:"opponent-hand",children:Array.from({length:e.top?.handCount||13}).map((i,t)=>n.jsx("div",{className:"opponent-tile back"},t))})]}),n.jsxs("div",{className:"opponent left",children:[n.jsx("span",{className:"opponent-name",children:e.left?.name}),n.jsx("div",{className:"opponent-hand vertical",children:Array.from({length:e.left?.handCount||13}).map((i,t)=>n.jsx("div",{className:"opponent-tile back"},t))})]}),n.jsxs("div",{className:"opponent right",children:[n.jsx("span",{className:"opponent-name",children:e.right?.name}),n.jsx("div",{className:"opponent-hand vertical",children:Array.from({length:e.right?.handCount||13}).map((i,t)=>n.jsx("div",{className:"opponent-tile back"},t))})]})]})}),js=o.memo(function({discardedTiles:e,lastDiscarded:i}){const t=o.useMemo(()=>e.map((s,r)=>n.jsx(N,{tile:s,className:i?.id===s.id?"last-discarded":""},`${s.id}-${r}`)),[e,i]);return n.jsx("div",{className:"table-area",children:n.jsx("div",{className:"discarded-tiles",children:t})})}),xs=o.memo(function({onHu:e,onPeng:i,onGang:t,onChi:s,onPass:r,onDraw:p,canHu:a,canPeng:d,canGang:l,canChi:j,isMyTurn:k,hasDrawn:u}){const m=o.useMemo(()=>{const f=[];return k&&!u&&f.push(n.jsxs("button",{className:"action-btn draw-btn",onClick:p,children:["æ‘¸ç‰Œ ",n.jsx("span",{className:"key-hint",children:"Space"})]},"draw")),a&&f.push(n.jsxs("button",{className:"action-btn hu-btn",onClick:e,children:["èƒ¡ ğŸ€… ",n.jsx("span",{className:"key-hint",children:"H"})]},"hu")),d&&f.push(n.jsxs("button",{className:"action-btn peng-btn",onClick:i,children:["ç¢° ",n.jsx("span",{className:"key-hint",children:"P"})]},"peng")),l&&f.push(n.jsxs("button",{className:"action-btn gang-btn",onClick:t,children:["æ  ",n.jsx("span",{className:"key-hint",children:"G"})]},"gang")),j&&f.push(n.jsxs("button",{className:"action-btn chi-btn",onClick:s,children:["åƒ ",n.jsx("span",{className:"key-hint",children:"C"})]},"chi")),k&&u&&f.push(n.jsxs("button",{className:"action-btn pass-btn",onClick:r,children:["è¿‡ ",n.jsx("span",{className:"key-hint",children:"Esc"})]},"pass")),f},[k,u,a,d,l,j,e,i,t,s,r,p]);return n.jsx("div",{className:"action-buttons",role:"group","aria-label":"æ¸¸æˆæ“ä½œ",children:m})});function ys(){const[c,e]=o.useState(!1),[i,t]=o.useState([]),[s,r]=o.useState([]),[p,a]=o.useState([]),[d,l]=o.useState(null),[j,k]=o.useState(null),[u,m]=o.useState(null),[f,v]=o.useState(0),[x,S]=o.useState(!1),[es,q]=o.useState([]),[ts,B]=o.useState([]),[ns,is]=o.useState([]),[T,E]=o.useState(!1),[D,C]=o.useState(""),[bs,F]=o.useState([]),as=o.useCallback(()=>{e(!0),setTimeout(()=>{const h=ms(ds());t(h);const g=X(h.slice(0,13));r(g),k(h[13]),F(h.slice(14,27)),a([]),l(null),m(null),v(0),S(!1),q([]),B([]),is([]),E(!0),C("æ¸¸æˆå¼€å§‹ï¼è¯·æ‘¸ç‰Œ"),e(!1)},300)},[]),$=o.useCallback(()=>{if(f!==0||x)return;const h=[...i],g=h.shift();if(!g)return;t(h),r(y=>X([...y,g])),k(g),S(!0);const b=[...s,g];_(b)?C("å¯ä»¥èƒ¡ç‰Œï¼"):C("è¯·é€‰æ‹©è¦æ‰“å‡ºçš„ç‰Œ")},[f,x,i,s]),J=o.useCallback(h=>{if(f!==0||!x)return;const g=s.filter(b=>b.id!==h.id);r(g),a(b=>[...b,h]),m(h),l(null),k(null),S(!1),v(1),C("ä¸‹å®¶æ‘¸ç‰Œä¸­..."),setTimeout(()=>{L()},1e3)},[f,x,s]),rs=o.useCallback(h=>{f===0&&x&&l(h)},[f,x]),Q=o.useCallback(()=>{d&&J(d)},[d,J]),H=o.useCallback(()=>{_(s)&&(C("ğŸ‰ èƒ¡ç‰Œäº†ï¼æ­å–œï¼"),E(!1))},[s]),M=o.useCallback(()=>{if(!u||!Y(s,u))return;const h=s.filter(y=>y.suit===u.suit&&y.num===u.num);if(h.length<2)return;const g=[u,h[0],h[1]],b=s.filter(y=>y.id!==h[0].id&&y.id!==h[1].id);r(b),q(y=>[...y,g]),a(y=>y.filter(w=>w.id!==u.id)),m(null),S(!0),C("ç¢°äº†ï¼è¯·æ‰“å‡ºä¸€å¼ ç‰Œ")},[u,s]),P=o.useCallback(()=>{if(!j||!Z(s,j))return;const h=s.filter(g=>g.suit===j.suit&&g.num===j.num);r(g=>g.filter(b=>b.id!==h[0].id&&b.id!==h[1].id&&b.id!==h[2].id)),B(g=>[...g,[...h,j]]),k(null),S(!1),C("æ äº†ï¼ç»§ç»­æ‘¸ç‰Œ"),$()},[j,s,$]),A=o.useCallback(()=>{if(!u||!ss(s,u))return;const h=fs(s,u);h.length>0&&C("åƒç‰Œé€‰é¡¹: "+h.length+" ç§")},[u,s]),L=o.useCallback(()=>{const h=[...i];if(h.length===0){C("æµå±€ï¼"),E(!1);return}const g=h.shift();g&&(t(h),F(b=>{const y=[...b,g],w=Math.floor(Math.random()*y.length),U=y[w];return a(V=>[...V,U]),m(U),y.filter((V,os)=>os!==w)}),v(0),C("è½®åˆ°ä½ è¡ŒåŠ¨äº†"))},[i]),z=o.useCallback(()=>{l(null),v(1),C("ä¸‹å®¶æ‘¸ç‰Œä¸­..."),setTimeout(()=>{L()},1e3)},[L]);o.useEffect(()=>{d&&x&&f===0&&Q()},[d,x,f,Q]),o.useEffect(()=>{if(T&&f===0&&!x){const h=setTimeout(()=>{$()},600);return()=>clearTimeout(h)}},[T,f,x,$]),o.useEffect(()=>{const h=g=>{if(!(!T||f!==0))switch(g.key){case"h":case"H":O&&H();break;case"p":case"P":G&&M();break;case"g":case"G":R&&P();break;case"c":case"C":I&&A();break;case" ":case"Enter":x||(g.preventDefault(),$());break;case"Escape":z();break}};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[T,f,O,G,R,I,x,H,M,P,A,z,$]);const cs=o.useMemo(()=>({top:{name:"ä¸Šå®¶",handCount:13},left:{name:"å¯¹å®¶",handCount:13},right:{name:"ä¸‹å®¶",handCount:13}}),[]),O=o.useMemo(()=>_(s),[s]),G=o.useMemo(()=>u&&Y(s,u),[u,s]),R=o.useMemo(()=>j&&Z(s,j),[j,s]),I=o.useMemo(()=>u&&ss(s,u),[u,s]);return n.jsxs("div",{className:"mahjong-game",children:[n.jsxs("div",{className:"game-header",children:[n.jsx("h1",{children:"ğŸ€„ éº»å°†æ¸¸æˆ ğŸ€„"}),D&&n.jsx("div",{className:"message",role:"status","aria-live":"polite",children:D})]}),c&&n.jsxs("div",{className:"loading-overlay","aria-live":"polite",children:[n.jsx("div",{className:"loading-spinner"}),n.jsx("p",{children:"æ­£åœ¨åŠ è½½æ¸¸æˆ..."})]}),!T&&!c&&n.jsx("div",{className:"start-screen",children:n.jsx("button",{className:"start-btn",onClick:as,"aria-label":"å¼€å§‹æ¸¸æˆ",children:"å¼€å§‹æ¸¸æˆ"})}),T&&!c&&n.jsxs(n.Fragment,{children:[n.jsx(gs,{opponents:cs}),n.jsx(js,{discardedTiles:p,lastDiscarded:u}),n.jsx("div",{className:"player-area",children:n.jsx(ps,{hand:s,selectedTile:d,onTileClick:rs,lastDrawn:j,pengs:es,gangs:ts,chis:ns})}),n.jsx(xs,{onHu:H,onPeng:M,onGang:P,onChi:A,onPass:z,onDraw:$,canHu:O,canPeng:G,canGang:R,canChi:I,isMyTurn:f===0,hasDrawn:x})]})]})}us.createRoot(document.getElementById("root")).render(n.jsx(o.StrictMode,{children:n.jsx(ys,{})}));
